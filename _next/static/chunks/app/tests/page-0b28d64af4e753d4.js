(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[396],{57837:function(e,t,s){Promise.resolve().then(s.bind(s,15260))},15260:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return ef}});var n=s(57437),r=s(2265),a=s(99376),i=s(76362),c=s(93113),l=s(2403),o=s(5194),d=s(1780),u=s(50059),m=s(85735),h=s(5853),f=s(280),x=s(66070),p=s(62869),j=s(73578),b=s(95186),v=s(26937),g=s(73247),y=s(90740),w=s(48736),N=s(91723),_=s(15868),C=s(14438),S=s(32832),k=s(4506);function q(e){var t,s=e.companyId,i=(0,a.useRouter)(),c=(0,u._)((0,r.useState)([]),2),q=c[0],E=c[1],T=(0,u._)((0,r.useState)(!0),2),O=T[0],A=T[1],z=(0,u._)((0,r.useState)(""),2),Z=z[0],I=z[1],M=(0,u._)((0,r.useState)(null),2),Q=M[0],L=M[1],P=(0,u._)((0,r.useState)(null),2),J=P[0],F=P[1],R=(0,u._)((0,r.useState)([]),2),G=R[0],U=R[1];(0,r.useEffect)(function(){function e(){return(e=(0,l._)(function(){var e,t,n,r,a;return(0,h.Jh)(this,function(i){switch(i.label){case 0:A(!0),i.label=1;case 1:return i.trys.push([1,3,4,5]),e=f.OQ.from("tests").select("\n            *,\n            companies:company_id (\n              name\n            )\n          ").order("created_at",{ascending:!1}),s&&(e=e.eq("company_id",s)),[4,e];case 2:if(n=(t=i.sent()).data,r=t.error)throw r;return E(a=n.map(function(e){var t;return(0,d._)((0,o._)({},e),{company_name:(null===(t=e.companies)||void 0===t?void 0:t.name)||"Unknown"})})),U((0,m._)(new Set(a.map(function(e){return e.category}))).filter(Boolean).sort()),[3,5];case 3:return console.error("Error fetching tests:",i.sent()),C.Am.error("Failed to load tests"),[3,5];case 4:return A(!1),[7];case 5:return[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[s]);var D=function(e){switch(e){case"Easy":default:return"⭐";case"Medium":return"⭐⭐";case"Advanced":return"⭐⭐⭐"}},B=q.filter(function(e){var t=e.title.toLowerCase().includes(Z.toLowerCase())||e.company_name.toLowerCase().includes(Z.toLowerCase()),s=!Q||e.complexity===Q,n=!J||e.category===J;return t&&s&&n}),W=(t=(0,l._)(function(e){var t,s,n,r,a,i,c,l,o;return(0,h.Jh)(this,function(d){switch(d.label){case 0:if(!confirm("Are you sure you want to delete this test?"))return[2];d.label=1;case 1:return d.trys.push([1,11,,12]),[4,f.OQ.from("tests").delete().eq("id",e)];case 2:if(t=d.sent().error)throw t;return[4,f.OQ.storage.from("test-content").remove(["".concat(e,".json")])];case 3:(s=d.sent().error)&&console.error("Error deleting test content file:",s),d.label=4;case 4:if(d.trys.push([4,9,,10]),!(n=q.find(function(t){return t.id===e})))return[3,8];return r="chatbot-flow-".concat(n.company_id,".json"),[4,f.OQ.storage.from("test-flows").download(r)];case 5:if(i=(a=d.sent()).data,!(!a.error&&i))return[3,8];return[4,i.text()];case 6:if(c=JSON.parse(d.sent()),l=!1,c.nodes&&Object.keys(c.nodes).forEach(function(t){var s=c.nodes[t];s.questionSetId&&s.questionSetId.standard&&["easy","medium","Advanced"].forEach(function(t){if(Array.isArray(s.questionSetId.standard[t])){var n=s.questionSetId.standard[t].indexOf(e);-1!==n&&(s.questionSetId.standard[t].splice(n,1),l=!0)}})}),!l)return[3,8];return c.metadata.lastUpdated=new Date().toISOString(),[4,f.OQ.storage.from("test-flows").upload(r,new Blob([JSON.stringify(c,null,2)],{type:"application/json"}),{upsert:!0})];case 7:(o=d.sent().error)&&console.error("Error updating flow after test deletion:",o),d.label=8;case 8:return[3,10];case 9:return console.error("Error updating flow references:",d.sent()),[3,10];case 10:return E(q.filter(function(t){return t.id!==e})),C.Am.success("Test deleted successfully"),[3,12];case 11:return console.error("Error deleting test:",d.sent()),C.Am.error("Failed to delete test"),[3,12];case 12:return[2]}})}),function(e){return t.apply(this,arguments)});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return i.push((0,k.G)("/companies?view=list"))}}].concat((0,m._)(s?[{label:"Company Tests"}]:[{label:"All Tests"}]))}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:s?"Company Tests":"All Tests"}),s&&(0,n.jsxs)(p.z,{onClick:function(){return i.push((0,k.G)("/tests?view=new&companyId=".concat(s)))},className:"text-base",children:[(0,n.jsx)(v.Z,{className:"mr-2 h-5 w-5"}),"Create New Test"]})]}),(0,n.jsxs)(x.Zb,{children:[(0,n.jsx)(x.Ol,{className:"pb-2",children:(0,n.jsx)(x.ll,{className:"text-xl",children:"Tests"})}),(0,n.jsxs)(x.aY,{children:[(0,n.jsxs)("div",{className:"flex flex-col space-y-4 mb-4 md:flex-row md:space-y-0 md:space-x-4 md:items-center",children:[(0,n.jsxs)("div",{className:"relative flex-1",children:[(0,n.jsx)(g.Z,{className:"absolute left-2.5 top-3 h-4 w-4 text-gray-500"}),(0,n.jsx)(b.I,{type:"search",placeholder:"Search tests...",className:"pl-8 text-base h-10",value:Z,onChange:function(e){return I(e.target.value)}})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)(y.Z,{className:"h-4 w-4 text-gray-500"}),(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Complexity:"}),(0,n.jsx)("div",{className:"flex space-x-1",children:["Easy","Medium","Advanced"].map(function(e){return(0,n.jsxs)(p.z,{variant:Q===e?"default":"outline",size:"sm",onClick:function(){Q===e?L(null):L(e)},className:"text-xs h-8",children:[D(e)," ",e]},e)})})]}),G.length>0&&(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,n.jsx)("span",{className:"text-sm text-gray-500",children:"Category:"}),(0,n.jsxs)("select",{className:"text-sm p-1 border rounded",value:J||"",onChange:function(e){return F(e.target.value||null)},children:[(0,n.jsx)("option",{value:"",children:"All"}),G.map(function(e){return(0,n.jsx)("option",{value:e,children:e},e)})]})]})]}),O?(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-e-transparent align-[-0.125em] text-primary"}),(0,n.jsx)("p",{className:"mt-2 text-gray-500",children:"Loading tests..."})]}):0===B.length?(0,n.jsxs)("div",{className:"text-center py-12 border rounded-md bg-gray-50",children:[(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:0===q.length?"No tests found":"No tests match your search criteria"}),s&&(0,n.jsx)(p.z,{onClick:function(){return i.push((0,k.G)("/tests?view=new&companyId=".concat(s)))},children:"Create your first test"})]}):(0,n.jsxs)(j.iA,{children:[(0,n.jsx)(j.xD,{children:(0,n.jsxs)(j.SC,{children:[(0,n.jsx)(j.ss,{className:"w-[40%] text-base",children:"Test Title"}),!s&&(0,n.jsx)(j.ss,{className:"text-base",children:"Company"}),(0,n.jsx)(j.ss,{className:"text-base",children:"Complexity"}),(0,n.jsx)(j.ss,{className:"text-base",children:"Category"}),(0,n.jsx)(j.ss,{className:"text-base",children:"Time"}),(0,n.jsx)(j.ss,{className:"text-base",children:"Created"}),(0,n.jsx)(j.ss,{className:"text-base text-right",children:"Actions"})]})}),(0,n.jsx)(j.RM,{children:B.map(function(e){var t;return(0,n.jsxs)(j.SC,{className:"cursor-pointer hover:bg-gray-50",onClick:function(){return i.push((0,k.G)("/tests?view=detail&id=".concat(e.id,"&companyId=").concat(e.company_id)))},children:[(0,n.jsx)(j.pj,{className:"font-medium text-base",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(w.Z,{className:"h-5 w-5 mr-2 text-gray-500"}),e.title]})}),!s&&(0,n.jsx)(j.pj,{className:"text-base",children:e.company_name}),(0,n.jsx)(j.pj,{className:"text-base",children:(0,n.jsx)("span",{title:e.complexity,children:D(e.complexity)})}),(0,n.jsx)(j.pj,{className:"text-base",children:e.category}),(0,n.jsx)(j.pj,{className:"text-base",children:(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(N.Z,{className:"h-4 w-4 mr-1 text-gray-500"}),(t=e.time_limit,"".concat(Math.floor(t/60)," min"))]})}),(0,n.jsx)(j.pj,{className:"text-base",children:new Date(e.created_at).toLocaleDateString()}),(0,n.jsxs)(j.pj,{className:"text-right",children:[(0,n.jsxs)(p.z,{variant:"ghost",size:"sm",onClick:function(t){t.stopPropagation(),i.push((0,k.G)("/tests?view=edit&id=".concat(e.id,"&companyId=").concat(e.company_id)))},children:[(0,n.jsx)(_.Z,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Edit"})]}),(0,n.jsxs)(p.z,{variant:"ghost",size:"sm",onClick:function(t){t.stopPropagation(),W(e.id)},children:[(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 text-red-500",viewBox:"0 0 20 20",fill:"currentColor",children:(0,n.jsx)("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})}),(0,n.jsx)("span",{className:"sr-only",children:"Delete"})]})]})]},e.id)})})]})]})]})]})}var E=s(43923),T=s(12339),O=s(51817),A=s(92451),z=s(10407),Z=s(82431),I=s(83229),M=s(32660),Q=s(48614),L=s(40521),P=s(57970),J=s(46796),F=s(6741),R=s(98575),G=s(73966),U=s(80886),D=s(6718),B=s(90420),W=s(66840),H="Switch",V=(0,u._)((0,G.b)(H),2),Y=V[0];V[1];var X=(0,u._)(Y(H),2),$=X[0],K=X[1],ee=r.forwardRef(function(e,t){var s=e.__scopeSwitch,a=e.name,i=e.checked,c=e.defaultChecked,l=e.required,m=e.disabled,h=e.value,f=void 0===h?"on":h,x=e.onCheckedChange,p=e.form,j=(0,J._)(e,["__scopeSwitch","name","checked","defaultChecked","required","disabled","value","onCheckedChange","form"]),b=(0,u._)(r.useState(null),2),v=b[0],g=b[1],y=(0,R.e)(t,function(e){return g(e)}),w=r.useRef(!1),N=!v||p||!!v.closest("form"),_=(0,u._)((0,U.T)({prop:i,defaultProp:c,onChange:x}),2),C=_[0],S=void 0!==C&&C,k=_[1];return(0,n.jsxs)($,{scope:s,checked:S,disabled:m,children:[(0,n.jsx)(W.WV.button,(0,d._)((0,o._)({type:"button",role:"switch","aria-checked":S,"aria-required":l,"data-state":er(S),"data-disabled":m?"":void 0,disabled:m,value:f},j),{ref:y,onClick:(0,F.M)(e.onClick,function(e){k(function(e){return!e}),N&&(w.current=e.isPropagationStopped(),w.current||e.stopPropagation())})})),N&&(0,n.jsx)(en,{control:v,bubbles:!w.current,name:a,value:f,checked:S,required:l,disabled:m,form:p,style:{transform:"translateX(-100%)"}})]})});ee.displayName=H;var et="SwitchThumb",es=r.forwardRef(function(e,t){var s=e.__scopeSwitch,r=(0,J._)(e,["__scopeSwitch"]),a=K(et,s);return(0,n.jsx)(W.WV.span,(0,d._)((0,o._)({"data-state":er(a.checked),"data-disabled":a.disabled?"":void 0},r),{ref:t}))});es.displayName=et;var en=function(e){var t=e.control,s=e.checked,a=e.bubbles,i=void 0===a||a,c=(0,J._)(e,["control","checked","bubbles"]),l=r.useRef(null),u=(0,D.D)(s),m=(0,B.t)(t);return r.useEffect(function(){var e=l.current,t=Object.getOwnPropertyDescriptor(window.HTMLInputElement.prototype,"checked").set;if(u!==s&&t){var n=new Event("click",{bubbles:i});t.call(e,s),e.dispatchEvent(n)}},[u,s,i]),(0,n.jsx)("input",(0,d._)((0,o._)({type:"checkbox","aria-hidden":!0,defaultChecked:s},c),{tabIndex:-1,ref:l,style:(0,d._)((0,o._)({},e.style,m),{position:"absolute",pointerEvents:"none",opacity:0,margin:0})}))};function er(e){return e?"checked":"unchecked"}var ea=s(94508),ei=r.forwardRef(function(e,t){var s=e.className,r=(0,J._)(e,["className"]);return(0,n.jsx)(ee,(0,d._)((0,o._)({className:(0,ea.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",s)},r),{ref:t,children:(0,n.jsx)(es,{className:(0,ea.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}))});ei.displayName=ee.displayName;var ec=["i.postimg.cc","i.imgur.com"],el=["Absolute Beginners","Web Development","Frameworks","Languages Platforms","Devops","Mobile Development","Databases","Computer Science","Machine Learning","Management","Game Development","Design","Block Chain","Cyber Security"];function eo(e){var t,s,i,c,o,d,m,j,b,v,g=e.testId,y=e.companyId,w=e.user,N=(0,a.useRouter)(),_=!!g,q=(0,u._)((0,r.useState)(null),2),J=q[0],F=q[1],R=(0,u._)((0,r.useState)(""),2),G=R[0],U=R[1],D=(0,u._)((0,r.useState)(""),2),B=D[0],W=D[1],H=(0,u._)((0,r.useState)(900),2),V=H[0],Y=H[1],X=(0,u._)((0,r.useState)("Medium"),2),$=X[0],K=X[1],ee=(0,u._)((0,r.useState)(""),2),et=ee[0],es=ee[1],en=(0,u._)((0,r.useState)(""),2),er=en[0],ea=en[1],eo=(0,u._)((0,r.useState)(!0),2),ed=eo[0],eu=eo[1],em=(0,u._)((0,r.useState)(!1),2),eh=em[0],ef=em[1],ex=(0,u._)((0,r.useState)("settings"),2),ep=(ex[0],ex[1]),ej=(0,u._)((0,r.useState)([]),2),eb=ej[0],ev=ej[1],eg=(0,u._)((0,r.useState)(!1),2),ey=(eg[0],eg[1]),ew=(0,u._)((0,r.useState)(0),2),eN=(ew[0],ew[1]),e_=(0,u._)((0,r.useState)([]),2),eC=(e_[0],e_[1]),eS=(0,u._)((0,r.useState)(null),2),ek=eS[0],eq=eS[1],eE=(0,u._)((0,r.useState)(0),2),eT=eE[0],eO=eE[1],eA=(0,u._)((0,r.useState)(!1),2),ez=(eA[0],eA[1]),eZ=(0,u._)((0,r.useState)(null),2),eI=eZ[0],eM=eZ[1],eQ=(0,u._)((0,r.useState)(""),2),eL=eQ[0];eQ[1],(0,r.useEffect)(function(){function e(){return(e=(0,l._)(function(){var e,t,s,n,r,a,i,c,l,o,d,u;return(0,h.Jh)(this,function(m){switch(m.label){case 0:eu(!0),m.label=1;case 1:return m.trys.push([1,12,13,14]),[4,f.OQ.from("companies").select("id, name").eq("id",y).single()];case 2:if(t=(e=m.sent()).data,s=e.error)throw s;if(F(t),!(_&&g))return[3,10];return[4,f.OQ.from("tests").select("*").eq("id",g).single()];case 3:if(r=(n=m.sent()).data,a=n.error)throw a;return U(r.id),W(r.title),Y(r.time_limit),K(r.complexity),es(r.category),[4,f.OQ.storage.from("test-content").download("".concat(r.id,".json"))];case 4:if(c=(i=m.sent()).data,!(l=i.error))return[3,7];return console.error("Error loading test content:",l),[4,f.OQ.storage.from("test-content").download("".concat(r.id,".md"))];case 5:if(d=(o=m.sent()).data,u=o.error)throw u;return[4,d.text()];case 6:return ea(m.sent()),[3,9];case 7:return[4,c.text()];case 8:ea(JSON.parse(m.sent()).questions.map(function(e){return e.question}).join("\n\n---\n\n")),m.label=9;case 9:return[3,11];case 10:U("TEST-".concat(Math.random().toString(36).substring(2,8).toUpperCase())),el.length>0&&es(el[0]),m.label=11;case 11:return[3,14];case 12:return console.error("Error loading data:",m.sent()),C.Am.error("Failed to load test data"),[3,14];case 13:return eu(!1),[7];case 14:return[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[y,g,_]);var eP=(t=(0,l._)(function(e){var t,s,n;return(0,h.Jh)(this,function(r){switch(r.label){case 0:t=[],ey(!0),eN(0),r.label=1;case 1:return r.trys.push([1,3,4,5]),e.length>5e3&&t.push({type:"error",message:"Content exceeds ".concat(5e3," characters limit")}),(s=e.split("---").filter(function(e){return e.trim()})).length>30&&t.push({type:"error",message:"Too many questions (".concat(s.length,"/").concat(30,")")}),s.forEach(function(e,s){e.trim()||t.push({type:"error",message:"Empty question found at position ".concat(s+1)})}),[4,eF(e)];case 2:return(n=r.sent()).length>0&&t.push({type:"warning",message:"".concat(n.length," image(s) have issues")}),eN(100),[2,t];case 3:return console.error("Validation error:",r.sent()),[2,[{type:"error",message:"Validation failed unexpectedly"}]];case 4:return ey(!1),[7];case 5:return[2]}})}),function(e){return t.apply(this,arguments)}),eJ=(s=(0,l._)(function(){var e,t,s,n,r,a,i,c,l,o,d,u,m,x,p,j;return(0,h.Jh)(this,function(h){switch(h.label){case 0:if(!B||!er)return C.Am.error("Please fill in all required fields"),[2];ef(!0),h.label=1;case 1:if(h.trys.push([1,15,16,17]),e=er.split("---").map(function(e,t){return{id:"q".concat(t+1),question:e.trim()}}).filter(function(e){return e.question.length>0}),t={id:G,title:"# ".concat(B),time_limit:V,questions:e},s=et.toLowerCase().replace(/\s+/g,"_"),n=$.toLowerCase(),r={id:G,title:B,category_id:s,complexity:$,time_limit:V,is_enabled:!0,company_id:y,version:1},!_)return[3,3];return[4,f.OQ.from("tests").update(r).eq("id",g)];case 2:if(a=h.sent().error)throw a;return[3,5];case 3:return[4,f.OQ.from("tests").insert([r])];case 4:if(i=h.sent().error)throw i;h.label=5;case 5:if(c=e.map(function(e,t){return{test_id:G,question_order:t+1,content:e.question,version:1}}),!_)return[3,7];return[4,f.OQ.from("test_questions").delete().eq("test_id",g)];case 6:h.sent(),h.label=7;case 7:return[4,f.OQ.from("test_questions").insert(c)];case 8:if(l=h.sent().error)throw l;return[4,f.OQ.storage.from("test-content").upload("".concat(G,".json"),new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),{upsert:!0})];case 9:if(o=h.sent().error)throw o;return d="chatbot-flow-".concat(y,".json"),[4,f.OQ.storage.from("test-flows").download(d)];case 10:if(m=(u=h.sent()).data,u.error)return[3,13];return p=JSON.parse,[4,m.text()];case 11:return(x=p.apply(JSON,[h.sent()])).nodes[s]||(x.nodes[s]={text:et,question:"Choose a ".concat(et," topic to focus on:"),options:[],isEndpoint:!0,questionSetId:{standard:{easy:[],medium:[],Advanced:[]}}}),j="Advanced"===$?"Advanced":n,x.nodes[s].questionSetId.standard[j].includes(G)||x.nodes[s].questionSetId.standard[j].push(G),[4,f.OQ.storage.from("test-flows").upload(d,new Blob([JSON.stringify(x,null,2)],{type:"application/json"}),{upsert:!0})];case 12:h.sent(),h.label=13;case 13:return[4,f.OQ.from("test_history").insert([{test_id:G,action:_?"updated":"created",changes:r,performed_by:w.id}])];case 14:return h.sent(),C.Am.success(_?"Test updated successfully":"Test created successfully"),N.push((0,k.G)("/companies?view=detail&id=".concat(y))),[3,17];case 15:return console.error("Error saving test:",h.sent()),C.Am.error("Failed to save test"),[3,17];case 16:return ef(!1),[7];case 17:return[2]}})}),function(){return s.apply(this,arguments)}),eF=(i=(0,l._)(function(e){var t,s,n,r,a,i,c,l,o,d,u;return(0,h.Jh)(this,function(m){switch(m.label){case 0:for(console.log("[IMAGE_CHECK] Starting image URL check on content"),t=/!\[.*?\]\((.*?)\)/g,s=[];null!==(n=t.exec(e));)n[1]&&s.push(n[1].trim());r=[],a=!0,i=!1,c=void 0,m.label=1;case 1:m.trys.push([1,6,7,8]),l=function(){var e,t;return(0,h.Jh)(this,function(s){switch(s.label){case 0:e=d.value,s.label=1;case 1:if(s.trys.push([1,3,,4]),t=new URL(e).hostname,!ec.includes(t))return r.push("".concat(e," (untrusted domain: ").concat(t,")")),[2,"continue"];return[4,new Promise(function(t){var s=new Image;s.onload=function(){return t(!0)},s.onerror=function(){return t(!1)},s.src=e,setTimeout(function(){return t(!1)},5e3)})];case 2:return s.sent()||r.push("".concat(e," (cannot be loaded)")),[3,4];case 3:return s.sent(),r.push("".concat(e," (invalid URL format)")),[3,4];case 4:return[2]}})},o=s[Symbol.iterator](),m.label=2;case 2:if(a=(d=o.next()).done)return[3,5];return[5,(0,h.XA)(l())];case 3:m.sent(),m.label=4;case 4:return a=!0,[3,2];case 5:return[3,8];case 6:return u=m.sent(),i=!0,c=u,[3,8];case 7:try{a||null==o.return||o.return()}finally{if(i)throw c}return[7];case 8:return eC(r),[2,r]}})}),function(e){return i.apply(this,arguments)});(0,l._)(function(){var e;return(0,h.Jh)(this,function(t){switch(t.label){case 0:return[4,eP(er)];case 1:return ev(e=t.sent()),0===e.length&&eq({id:G,title:B,time_limit:V,questions:er.split("---").map(function(e){return e.trim()}).filter(function(e){return e.length>0}).map(function(e,t){return{id:"q".concat(t+1),question:e}})}),[2]}})}),(0,l._)(function(e,t,s){var n,r;return(0,h.Jh)(this,function(a){switch(a.label){case 0:return n=RegExp("!\\[.*?\\]\\(".concat(e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"\\)"),"g"),ea(r=er.replace(n,function(s){return s.replace(e,t)})),eC([]),s.value="",[4,eF(r)];case 1:return 0===a.sent().length&&C.Am.success("Image URL replaced successfully"),[2]}})});var eR=(c=(0,l._)(function(e,t){var s;return(0,h.Jh)(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,f.OQ.from("tests").update({is_enabled:t}).eq("id",e)];case 1:if(s=n.sent().error)throw s;return C.Am.success("Test ".concat(t?"enabled":"disabled"," successfully")),[3,3];case 2:return console.error("Error updating test status:",n.sent()),C.Am.error("Failed to update test status"),[3,3];case 3:return[2]}})}),function(e,t){return c.apply(this,arguments)}),eG=(o=(0,l._)(function(e){var t,s,n;return(0,h.Jh)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,f.OQ.from("tests").select("*").eq("id",e).single()];case 1:if(s=(t=r.sent()).data,n=t.error)throw n;return eM(s),ep("test"),[3,3];case 2:return console.error("Error loading test:",r.sent()),C.Am.error("Failed to load test"),[3,3];case 3:return[2]}})}),function(e){return o.apply(this,arguments)}),eU=(d=(0,l._)(function(){var e;return(0,h.Jh)(this,function(t){switch(t.label){case 0:if(!er)return C.Am.error("No content to preview"),[2];return[4,eP(er)];case 1:return ev(e=t.sent()),0===e.length&&(er.split("---").map(function(e,t){return{id:"q".concat(t+1),question:e.trim()}}).filter(function(e){return e.question.length>0}),eM({id:G,title:B,category:et,complexity:$,time_limit:V,markdown_content:er})),[2]}})}),function(){return d.apply(this,arguments)});return ed?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return N.push((0,k.G)("/companies?view=list"))}},{label:"Loading..."}]}),(0,n.jsxs)("div",{className:"flex items-center justify-center h-64",children:[(0,n.jsx)(O.Z,{className:"h-8 w-8 animate-spin text-primary"}),(0,n.jsx)("span",{className:"ml-2 text-lg",children:"Loading..."})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return N.push((0,k.G)("/companies?view=list"))}},{label:(null==J?void 0:J.name)||"",onClick:function(){return N.push((0,k.G)("/companies?view=detail&id=".concat(y)))}},{label:_?"Edit Test":"Create Test"}]}),(0,n.jsxs)("div",{className:"mb-6",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-2",children:_?"Edit Test":"Create New Test"}),(0,n.jsx)("p",{className:"text-gray-500",children:_?"Update test details and questions":"Define the test settings and add questions"})]}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,n.jsx)(x.Zb,{className:"col-span-1",children:(0,n.jsx)(x.aY,{className:"pt-6",children:(0,n.jsxs)(T.mQ,{defaultValue:"menu",children:[(0,n.jsxs)(T.dr,{children:[(0,n.jsx)(T.SP,{value:"menu",children:"Test Menu"}),(0,n.jsx)(T.SP,{value:"test",children:"Test Editor"})]}),(0,n.jsx)(T.nU,{value:"menu",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("h3",{children:"Test Categories and Tests"}),(0,n.jsx)(p.z,{onClick:function(){return ez(!0)},children:"Add New Test"})]}),(m=eL.split("\n"),j=[],b=null,m.forEach(function(e){if(e.startsWith("-")&&!e.startsWith("--"))b={category:e.replace("-","").trim(),tests:[]},j.push(b);else if(e.startsWith("--")&&b){var t=e.replace("--","").trim(),s=(0,E._)(t.split(" ")),n=s[0],r=s.slice(1);b.tests.push({id:n,name:r.join(" "),isEnabled:!0})}}),j).map(function(e){return(0,n.jsxs)(x.Zb,{children:[(0,n.jsx)(x.Ol,{children:(0,n.jsx)(x.ll,{children:e.category})}),(0,n.jsx)(x.aY,{children:(0,n.jsx)("div",{className:"space-y-2",children:e.tests.map(function(e){return(0,n.jsxs)("div",{className:"flex items-center justify-between p-2 border rounded",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("span",{className:"font-medium",children:e.id}),(0,n.jsx)("span",{className:"ml-2 text-muted-foreground",children:e.name})]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(ei,{checked:e.isEnabled,onCheckedChange:function(t){return eR(e.id,t)}}),(0,n.jsx)(p.z,{variant:"ghost",onClick:function(){return eG(e.id)},children:"Edit"})]})]},e.id)})})})]},e.category)})]})}),(0,n.jsx)(T.nU,{value:"test",children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("h3",{children:["Edit Test: ",null==eI?void 0:eI.id]}),(0,n.jsxs)("div",{className:"flex space-x-2",children:[(0,n.jsx)(p.z,{variant:"outline",onClick:eU,children:"Preview"}),(0,n.jsx)(p.z,{onClick:eJ,children:"Save Changes"})]})]}),(0,n.jsx)(T.mQ,{defaultValue:"info",children:(0,n.jsxs)(T.dr,{children:[(0,n.jsx)(T.SP,{value:"info",children:"Test Info"}),(0,n.jsx)(T.SP,{value:"questions",children:"Questions"}),(0,n.jsx)(T.SP,{value:"history",children:"History"})]})})]})})]})})}),(0,n.jsxs)(x.Zb,{className:"col-span-1",children:[(0,n.jsx)(x.Ol,{className:"py-3 px-4 border-b flex justify-between items-center",children:(0,n.jsxs)("div",{className:"flex flex-col",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,n.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full bg-blue-50 text-blue-700 border border-blue-200",children:$}),et&&(0,n.jsx)("span",{className:"text-xs font-medium px-2 py-0.5 rounded-full bg-gray-50 text-gray-700 border border-gray-200",children:et})]}),(0,n.jsx)("h1",{className:"text-lg font-semibold justify-center",children:B||"New Test"})]})}),(0,n.jsx)("div",{className:"py-3 px-4 bg-primary/5 border-b border-primary/20 flex items-center",children:(0,n.jsxs)("span",{className:"text-sm font-medium",children:["Time limit: ",V/60," minutes"]})}),(0,n.jsx)(x.aY,{className:"flex-grow p-0",children:ek&&ek.questions.length>0?(0,n.jsx)("div",{className:"flex flex-col h-[600px]",children:(0,n.jsx)(Q.M,{mode:"wait",children:(0,n.jsxs)(L.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},className:"flex-grow flex flex-col p-4 overflow-auto",children:[(0,n.jsx)("div",{className:"flex items-center mb-2",children:(0,n.jsxs)("span",{className:"text-xs text-muted-foreground",children:["Question ",eT+1," of ",ek.questions.length]})}),(0,n.jsx)("div",{className:"flex-grow overflow-y-auto mb-4",children:(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:'\n                          <style>\n                            .md-content h1 { font-size: 1.8em; font-weight: bold; margin-bottom: 0.5em; }\n                            .md-content h2 { font-size: 1.5em; font-weight: bold; margin-bottom: 0.5em; }\n                            .md-content pre { background-color: #f4f4f4; padding: 1rem; border-radius: 4px; }\n                            .md-content ul { list-style-type: disc; margin-left: 1.5em; }\n                            .md-content ol { list-style-type: decimal; margin-left: 1.5em; }\n                            .md-content code { background-color: #f4f4f4; padding: 0.2em 0.4em; border-radius: 3px; font-family: monospace; }\n                          </style>\n                          <div class="md-content">'.concat((0,P.TU)((null===(v=ek.questions[eT])||void 0===v?void 0:v.question)||""),"</div>\n                        ")},className:"question-content"})}),(0,n.jsxs)("div",{className:"flex justify-between mt-auto pt-2 border-t",children:[(0,n.jsxs)(p.z,{onClick:function(){eO(function(e){return Math.max(0,e-1)})},disabled:0===eT,variant:"ghost",size:"sm",className:"text-xs",children:[(0,n.jsx)(A.Z,{className:"mr-1 h-4 w-4"})," Previous"]}),(0,n.jsxs)(p.z,{onClick:function(){ek&&eO(function(e){return Math.min(ek.questions.length-1,e+1)})},disabled:eT===ek.questions.length-1,variant:"ghost",size:"sm",className:"text-xs",children:["Next ",(0,n.jsx)(z.Z,{className:"ml-1 h-4 w-4"})]})]})]},eT)})}):(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center h-[600px] text-center p-6",children:[(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsx)(Z.Z,{className:"h-10 w-10 text-muted-foreground mx-auto mb-2"}),(0,n.jsx)("h3",{className:"text-lg font-medium",children:"No Preview Available"})]}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground max-w-md",children:'Write your questions in the editor and click "Update Preview".'})]})}),(0,n.jsx)(x.eW,{className:"flex justify-between",children:(0,n.jsx)(p.z,{onClick:eJ,disabled:eh||!B||0===er.length||eb.length>0,children:eh?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.Z,{className:"mr-2 h-4 w-4"}),_?"Update Test":"Create Test"]})})})]})]}),(0,n.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,n.jsxs)(p.z,{variant:"outline",onClick:function(){return N.push((0,k.G)("/companies?view=detail&id=".concat(y)))},className:"h-12 px-6 text-base",children:[(0,n.jsx)(M.Z,{className:"mr-2 h-5 w-5"}),"Back"]}),(0,n.jsx)(p.z,{onClick:eJ,disabled:eh||!B||0===er.length||eb.length>0,className:"h-12 px-8 text-base",children:eh?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(O.Z,{className:"mr-2 h-5 w-5 animate-spin"}),_?"Updating...":"Creating..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.Z,{className:"mr-2 h-5 w-5"}),_?"Update Test":"Create Test"]})})]})]})}var ed=s(11411),eu=s.n(ed);function em(e){var t,s,i,c=e.testId,m=(0,a.useRouter)(),j=(0,u._)((0,r.useState)(null),2),b=j[0],v=j[1],g=(0,u._)((0,r.useState)([]),2),y=g[0],w=g[1],q=(0,u._)((0,r.useState)(0),2),E=q[0],T=q[1],O=(0,u._)((0,r.useState)(!0),2),Z=O[0],I=O[1],Q=(0,u._)((0,r.useState)(""),2),L=Q[0];return(Q[1],(0,r.useEffect)(function(){function e(){return(e=(0,l._)(function(){var e,t,s,n,r,a,i;return(0,h.Jh)(this,function(l){switch(l.label){case 0:I(!0),l.label=1;case 1:return l.trys.push([1,5,6,7]),[4,f.OQ.from("tests").select("\n            *,\n            companies:company_id (\n              name\n            )\n          ").eq("id",c).single()];case 2:if(s=(t=l.sent()).data,n=t.error)throw n;return v((0,d._)((0,o._)({},s),{company_name:(null===(e=s.companies)||void 0===e?void 0:e.name)||"Unknown"})),[4,f.OQ.storage.from("test-content").download("".concat(c,".json"))];case 3:if(a=(r=l.sent()).data,i=r.error)throw i;return[4,a.text()];case 4:return w(JSON.parse(l.sent()).questions||[]),[3,7];case 5:return console.error("Error fetching test:",l.sent()),C.Am.error("Failed to load test details"),[3,7];case 6:return I(!1),[7];case 7:return[2]}})})).apply(this,arguments)}!function(){e.apply(this,arguments)}()},[c]),Z)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return m.push((0,k.G)("/companies?view=list"))}},{label:"Loading..."}]}),(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("div",{className:"inline-block h-8 w-8 animate-spin rounded-full border-4 border-solid border-current border-e-transparent align-[-0.125em] text-primary"}),(0,n.jsx)("p",{className:"mt-2 text-gray-500",children:"Loading test details..."})]})]}):b?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return m.push((0,k.G)("/companies?view=list"))}},{label:b.company_name,onClick:function(){return m.push((0,k.G)("/companies?view=detail&id=".concat(b.company_id)))}},{label:b.title}]}),(0,n.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-1",children:b.title}),(0,n.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("span",{className:"mr-1",children:function(e){switch(e){case"Easy":default:return"⭐";case"Medium":return"⭐⭐";case"Advanced":return"⭐⭐⭐"}}(b.complexity)}),(0,n.jsx)("span",{children:b.complexity})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)(N.Z,{className:"h-4 w-4 mr-1"}),(0,n.jsx)("span",{children:(t=b.time_limit,"".concat(Math.floor(t/60),":").concat((t%60).toString().padStart(2,"0")))})]}),(0,n.jsx)("div",{children:b.category})]})]}),(0,n.jsxs)("div",{className:"flex space-x-3",children:[(0,n.jsxs)(p.z,{variant:"outline",onClick:function(){return m.push((0,k.G)("/companies?view=detail&id=".concat(b.company_id)))},children:[(0,n.jsx)(M.Z,{className:"mr-2 h-4 w-4"}),"Back"]}),(0,n.jsxs)(p.z,{onClick:function(){return m.push((0,k.G)("/tests?view=edit&id=".concat(c,"&companyId=").concat(b.company_id)))},children:[(0,n.jsx)(_.Z,{className:"mr-2 h-4 w-4"}),"Edit Test"]})]})]}),0===y.length?(0,n.jsx)(x.Zb,{children:(0,n.jsx)(x.aY,{className:"py-12 text-center",children:(0,n.jsx)("p",{className:"text-gray-500",children:"No questions found in this test"})})}):(0,n.jsxs)(x.Zb,{className:"mb-6",children:[(0,n.jsx)(x.Ol,{className:"pb-0",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsx)(x.ll,{className:"text-xl",children:"Question Preview"}),(0,n.jsxs)("div",{className:"text-sm text-gray-500",children:["Question ",E+1," of ",y.length]})]})}),(0,n.jsx)(x.aY,{className:"py-6",children:(0,n.jsx)("div",{className:"prose prose-gray max-w-none",children:(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:(s=y[E].question,i=P.TU.parse(s),eu().sanitize(i))}})})}),(0,n.jsxs)(x.eW,{className:"flex justify-between py-4 border-t",children:[(0,n.jsxs)(p.z,{variant:"outline",size:"sm",onClick:function(){E>0&&T(function(e){return e-1})},disabled:0===E,children:[(0,n.jsx)(A.Z,{className:"mr-1 h-4 w-4"}),"Previous"]}),(0,n.jsxs)(p.z,{variant:"outline",size:"sm",onClick:function(){E<y.length-1&&T(function(e){return e+1})},disabled:E===y.length-1,children:["Next",(0,n.jsx)(z.Z,{className:"ml-1 h-4 w-4"})]})]})]}),(0,n.jsxs)("div",{className:"mt-6",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Markdown Source"}),(0,n.jsx)(x.Zb,{children:(0,n.jsx)(x.aY,{className:"p-4",children:(0,n.jsx)("pre",{className:"bg-gray-50 p-4 rounded-md overflow-auto max-h-96 text-sm font-mono",children:L})})})]})]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(S.Z,{items:[{label:"Companies",onClick:function(){return m.push((0,k.G)("/companies?view=list"))}},{label:"Test Not Found"}]}),(0,n.jsxs)("div",{className:"text-center py-12 border rounded-md bg-gray-50",children:[(0,n.jsx)("p",{className:"text-gray-500 mb-4",children:"Test not found"}),(0,n.jsx)(p.z,{variant:"outline",onClick:function(){return m.push((0,k.G)("/companies?view=list"))},children:"Back to Companies"})]})]})}function eh(){var e=(0,i.a)(),t=e.user,s=e.loading,r=(0,a.useSearchParams)(),c=(0,a.useRouter)(),l=r.get("view")||"list",o=r.get("id"),d=r.get("companyId");return s?(0,n.jsx)("div",{children:"Loading..."}):t?(0,n.jsxs)(n.Fragment,{children:["list"===l&&(0,n.jsx)(q,{companyId:d}),"new"===l&&d&&(0,n.jsx)(eo,{companyId:d,user:t}),"edit"===l&&o&&d&&(0,n.jsx)(eo,{testId:o,companyId:d,user:t}),"detail"===l&&o&&(0,n.jsx)(em,{testId:o})]}):(c.push("/login"),null)}function ef(){return(0,n.jsx)(c.Z,{children:(0,n.jsx)(r.Suspense,{fallback:(0,n.jsx)("div",{className:"p-4 text-center",children:"Loading..."}),children:(0,n.jsx)(eh,{})})})}},82431:function(e,t,s){"use strict";s.d(t,{Z:function(){return n}});var n=(0,s(79205).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},6718:function(e,t,s){"use strict";s.d(t,{D:function(){return r}});var n=s(2265);function r(e){let t=n.useRef({value:e,previous:e});return n.useMemo(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}},90420:function(e,t,s){"use strict";s.d(t,{t:function(){return a}});var n=s(2265),r=s(61188);function a(e){let[t,s]=n.useState(void 0);return(0,r.b)(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let n,r;if(!Array.isArray(t)||!t.length)return;let a=t[0];if("borderBoxSize"in a){let e=a.borderBoxSize,t=Array.isArray(e)?e[0]:e;n=t.inlineSize,r=t.blockSize}else n=e.offsetWidth,r=e.offsetHeight;s({width:n,height:r})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}s(void 0)},[e]),t}},43923:function(e,t,s){"use strict";s.d(t,{_:function(){return c}});var n=s(56648),r=s(413),a=s(53311),i=s(94855);function c(e){return(0,n.o)(e)||(0,r.f)(e)||(0,i.N)(e)||(0,a.i)()}}},function(e){e.O(0,[518,825,777,648,438,795,371,411,814,971,117,744],function(){return e(e.s=57837)}),_N_E=e.O()}]);